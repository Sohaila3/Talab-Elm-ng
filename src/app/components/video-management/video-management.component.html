<div class="min-h-screen w-full bg-[#F5F7FA] font-['Cairo'] flex flex-col">

    <!-- Success Toast -->
    <div *ngIf="showSaveSuccess"
        class="fixed top-4 right-4 z-50 bg-[#10B981] text-white px-6 py-3 rounded-xl shadow-lg flex items-center gap-3 animate-in slide-in-from-top">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        <span class="font-bold">{{ translationService.current === 'ar' ? 'تم حفظ التغييرات بنجاح!' : 'Changes saved
            successfully!' }}</span>
    </div>

    <!-- Main Content -->
    <main class="flex-1 p-4 sm:p-6 md:p-10 overflow-y-auto">
        <div class="max-w-[1600px] mx-auto flex flex-col gap-6 sm:gap-8 pb-10">

            <!-- Header -->
            <div class="flex flex-col lg:flex-row lg:items-end justify-between gap-4">
                <div class="flex flex-col gap-2">
                    <div class="flex flex-wrap items-center gap-3">
                        <span
                            [class]="isAddMode 
                            ? 'bg-[#ECFDF5] text-[#10B981] text-[11px] font-black px-2.5 py-1 rounded-md border border-[#D1FAE5] tracking-wider'
                            : 'bg-[#EFF6FF] text-[#1877F2] text-[11px] font-black px-2.5 py-1 rounded-md border border-[#DBEAFE] tracking-wider'">
                            {{ isAddMode ? (translationService.current === 'ar' ? 'إضافة جديد' : 'NEW') : moduleLabel }}
                        </span>
                        <span *ngIf="!isAddMode && displayLastModified"
                            class="text-[#94A3B8] text-xs font-semibold flex items-center gap-1">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            {{ 'LAST_MODIFIED' | translate }}: {{ displayLastModified }}
                        </span>
                    </div>
                    <h1 class="text-xl sm:text-2xl md:text-3xl font-black text-[#0F172A] leading-tight">
                        {{ getPageTitle() }}
                    </h1>
                </div>

                <div class="flex items-center gap-3">
                    <button (click)="cancelChanges()"
                        class="h-10 sm:h-11 px-4 sm:px-6 bg-white border border-[#E2E8F0] text-[#64748B] font-bold rounded-xl hover:bg-[#F8FAFC] hover:text-[#0F172A] transition-all shadow-sm text-sm">
                        {{ 'CANCEL' | translate }}
                    </button>
                    <button (click)="saveChanges()"
                        [class]="isAddMode
                        ? 'h-10 sm:h-11 px-6 sm:px-8 bg-[#10B981] text-white font-bold rounded-xl hover:bg-[#059669] hover:shadow-lg hover:shadow-green-500/30 transition-all flex items-center gap-2 shadow-md shadow-green-500/20 text-sm'
                        : 'h-10 sm:h-11 px-6 sm:px-8 bg-[#1877F2] text-white font-bold rounded-xl hover:bg-[#1565D8] hover:shadow-lg hover:shadow-blue-500/30 transition-all flex items-center gap-2 shadow-md shadow-blue-500/20 text-sm'">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24"
                            stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        <span>{{ isAddMode ? (translationService.current === 'ar' ? 'حفظ وإضافة' : 'Save & Add') :
                            ('SAVE_CHANGES' | translate) }}</span>
                    </button>
                </div>
            </div>

            <!-- Content Grid -->
            <div class="grid grid-cols-1 xl:grid-cols-12 gap-6 sm:gap-8 items-start">

                <!-- Left Column (Main Content) -->
                <div class="xl:col-span-8 flex flex-col gap-6">

                    <!-- Video Source Section -->
                    <div class="bg-white rounded-2xl border border-[#E2E8F0] shadow-sm overflow-hidden">
                        <div
                            class="px-4 sm:px-6 py-4 sm:py-5 border-b border-[#F1F5F9] flex items-center justify-between">
                            <div class="flex items-center gap-3">
                                <div class="w-1 h-5 bg-[#1877F2] rounded-full"></div>
                                <h2 class="font-bold text-base sm:text-lg text-[#0F172A]">{{ 'VIDEO_SOURCE' | translate
                                    }}</h2>
                            </div>
                        </div>

                        <div class="p-4 sm:p-6">
                            <!-- Tab Switcher -->
                            <div class="flex bg-[#F1F5F9] p-1 rounded-xl w-fit mb-6">
                                <button (click)="setActiveTab('upload')"
                                    [class]="activeTab === 'upload'
                                        ? 'px-4 sm:px-6 py-2 sm:py-2.5 rounded-lg text-xs sm:text-sm font-bold transition-all flex items-center gap-2 bg-white text-[#1877F2] shadow-sm'
                                        : 'px-4 sm:px-6 py-2 sm:py-2.5 rounded-lg text-xs sm:text-sm font-bold transition-all flex items-center gap-2 text-[#64748B] hover:text-[#0F172A]'">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 sm:w-5 sm:h-5" fill="none"
                                        viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                                    </svg>
                                    {{ 'DIRECT_UPLOAD' | translate }}
                                </button>
                                <button (click)="setActiveTab('stream')"
                                    [class]="activeTab === 'stream'
                                        ? 'px-4 sm:px-6 py-2 sm:py-2.5 rounded-lg text-xs sm:text-sm font-bold transition-all flex items-center gap-2 bg-white text-[#1877F2] shadow-sm'
                                        : 'px-4 sm:px-6 py-2 sm:py-2.5 rounded-lg text-xs sm:text-sm font-bold transition-all flex items-center gap-2 text-[#64748B] hover:text-[#0F172A]'">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none"
                                        viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" />
                                    </svg>
                                    {{ 'STREAM_LINK' | translate }}
                                </button>
                            </div>

                            <!-- Upload Tab -->
                            <div *ngIf="activeTab === 'upload' && !isUploading && !uploadedVideoName"
                                (click)="triggerVideoUpload()"
                                class="border-2 border-dashed border-[#BFDBFE] bg-[#EFF6FF]/30 rounded-2xl p-6 sm:p-10 flex flex-col items-center justify-center text-center group hover:bg-[#EFF6FF]/50 hover:border-[#3B82F6] transition-all cursor-pointer">
                                <div
                                    class="w-14 h-14 sm:w-16 sm:h-16 bg-[#EFF6FF] text-[#3B82F6] rounded-2xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform shadow-inner">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="w-7 h-7 sm:w-8 sm:h-8" fill="none"
                                        viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                                    </svg>
                                </div>
                                <h3 class="text-base sm:text-lg font-bold text-[#1E293B] mb-2">{{ 'DRAG_VIDEO_HERE' |
                                    translate }}</h3>
                                <p class="text-[#64748B] font-medium text-xs sm:text-sm mb-4 sm:mb-6">{{
                                    'OR_BROWSE_FILES' | translate }}</p>
                                <span
                                    class="text-xs font-bold text-[#94A3B8] bg-white px-3 py-1.5 rounded-full border border-[#E2E8F0]">
                                    MP4, WebM, Ogg (Max 500MB)
                                </span>
                            </div>

                            <!-- Uploading State -->
                            <div *ngIf="isUploading"
                                class="border-2 border-[#3B82F6] bg-[#EFF6FF]/50 rounded-2xl p-6 sm:p-10 flex flex-col items-center justify-center text-center">
                                <div
                                    class="w-14 h-14 sm:w-16 sm:h-16 bg-[#EFF6FF] text-[#3B82F6] rounded-2xl flex items-center justify-center mb-4 animate-pulse">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="w-7 h-7 sm:w-8 sm:h-8 animate-bounce"
                                        fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                                    </svg>
                                </div>
                                <h3 class="text-base sm:text-lg font-bold text-[#1E293B] mb-2">{{
                                    translationService.current === 'ar' ? 'جاري رفع الفيديو...' : 'Uploading video...'
                                    }}</h3>
                                <p class="text-[#64748B] font-medium text-sm mb-4">{{ uploadedVideoName }}</p>
                                <div class="w-full max-w-xs bg-[#E2E8F0] rounded-full h-2 overflow-hidden">
                                    <div class="bg-[#3B82F6] h-full rounded-full transition-all duration-300"
                                        [style.width.%]="uploadProgress"></div>
                                </div>
                                <p class="text-sm font-bold text-[#3B82F6] mt-2">{{ uploadProgress | number:'1.0-0' }}%
                                </p>
                            </div>

                            <!-- Uploaded State -->
                            <div *ngIf="activeTab === 'upload' && !isUploading && uploadedVideoName"
                                class="border-2 border-[#10B981] bg-[#ECFDF5]/50 rounded-2xl p-6 flex items-center justify-between">
                                <div class="flex items-center gap-4">
                                    <div
                                        class="w-12 h-12 bg-[#10B981] text-white rounded-xl flex items-center justify-center">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none"
                                            viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                        </svg>
                                    </div>
                                    <div>
                                        <h3 class="font-bold text-[#065F46]">{{ translationService.current === 'ar' ?
                                            'تم رفع الفيديو بنجاح' : 'Video uploaded successfully' }}</h3>
                                        <p class="text-sm text-[#047857]">{{ uploadedVideoName }}</p>
                                    </div>
                                </div>
                                <button (click)="uploadedVideoName = ''; triggerVideoUpload()"
                                    class="px-4 py-2 bg-white border border-[#10B981] text-[#10B981] rounded-lg font-bold text-sm hover:bg-[#10B981] hover:text-white transition-all">
                                    {{ translationService.current === 'ar' ? 'تغيير الفيديو' : 'Change Video' }}
                                </button>
                            </div>

                            <!-- Stream Tab -->
                            <div *ngIf="activeTab === 'stream'"
                                class="bg-[#F8FAFC] rounded-2xl p-6 sm:p-8 border border-[#E2E8F0]">
                                <label class="block text-sm font-bold text-[#0F172A] mb-2">{{ 'VIDEO_LINK_LABEL' |
                                    translate }} (m3u8, mp4)</label>
                                <input type="text" [(ngModel)]="streamUrl" placeholder="https://example.com/video.mp4"
                                    class="w-full h-11 px-4 rounded-xl border border-[#CBD5E1] bg-white text-[#0F172A] focus:outline-none focus:border-[#1877F2] focus:ring-4 focus:ring-[#1877F2]/10 transition-all font-medium">
                            </div>
                        </div>
                    </div>

                    <!-- Video Details Section -->
                    <div class="bg-white rounded-2xl border border-[#E2E8F0] shadow-sm overflow-hidden">
                        <div
                            class="px-4 sm:px-6 py-4 sm:py-5 border-b border-[#F1F5F9] flex items-center justify-between">
                            <div class="flex items-center gap-3">
                                <div class="w-1 h-5 bg-[#1877F2] rounded-full"></div>
                                <h2 class="font-bold text-base sm:text-lg text-[#0F172A]">{{ 'VIDEO_DETAILS' | translate
                                    }}</h2>
                            </div>
                        </div>

                        <div class="p-4 sm:p-6 md:p-8 grid grid-cols-1 lg:grid-cols-3 gap-6 sm:gap-8">
                            <div class="lg:col-span-2 flex flex-col gap-4 sm:gap-6">
                                <!-- Arabic Title -->
                                <div>
                                    <label class="block text-sm font-bold text-[#0F172A] mb-2">
                                        {{ translationService.current === 'ar' ? 'عنوان الفيديو بالعربية' : 'Video Title
                                        (Arabic)' }} <span class="text-[#EF4444]">*</span>
                                    </label>
                                    <input type="text" [(ngModel)]="videoTitle"
                                        [placeholder]="translationService.current === 'ar' ? 'أدخل عنوان الفيديو بالعربية' : 'Enter video title in Arabic'"
                                        class="w-full h-11 px-4 rounded-xl border border-[#CBD5E1] bg-white text-[#0F172A] focus:outline-none focus:border-[#1877F2] focus:ring-4 focus:ring-[#1877F2]/10 transition-all font-medium placeholder:text-[#94A3B8]"
                                        dir="rtl" />
                                </div>

                                <!-- English Title -->
                                <div>
                                    <label class="block text-sm font-bold text-[#0F172A] mb-2">
                                        {{ translationService.current === 'ar' ? 'عنوان الفيديو بالإنجليزية' : 'Video
                                        Title (English)' }} <span class="text-[#EF4444]">*</span>
                                    </label>
                                    <input type="text" [(ngModel)]="videoTitleEn"
                                        [placeholder]="translationService.current === 'ar' ? 'أدخل عنوان الفيديو بالإنجليزية' : 'Enter video title in English'"
                                        class="w-full h-11 px-4 rounded-xl border border-[#CBD5E1] bg-white text-[#0F172A] focus:outline-none focus:border-[#1877F2] focus:ring-4 focus:ring-[#1877F2]/10 transition-all font-medium placeholder:text-[#94A3B8]"
                                        dir="ltr" />
                                </div>

                                <!-- Arabic Description -->
                                <div>
                                    <label class="block text-sm font-bold text-[#0F172A] mb-2">
                                        {{ translationService.current === 'ar' ? 'الوصف بالعربية' : 'Description
                                        (Arabic)' }}
                                    </label>
                                    <textarea rows="4" [(ngModel)]="videoDescription"
                                        [placeholder]="translationService.current === 'ar' ? 'أدخل وصف الفيديو بالعربية' : 'Enter video description in Arabic'"
                                        class="w-full p-4 rounded-xl border border-[#CBD5E1] bg-white text-[#0F172A] focus:outline-none focus:border-[#1877F2] focus:ring-4 focus:ring-[#1877F2]/10 transition-all font-medium placeholder:text-[#94A3B8] resize-none leading-relaxed"
                                        dir="rtl">
                                    </textarea>
                                </div>

                                <!-- English Description -->
                                <div>
                                    <label class="block text-sm font-bold text-[#0F172A] mb-2">
                                        {{ translationService.current === 'ar' ? 'الوصف بالإنجليزية' : 'Description
                                        (English)' }}
                                    </label>
                                    <textarea rows="4" [(ngModel)]="videoDescriptionEn"
                                        [placeholder]="translationService.current === 'ar' ? 'أدخل وصف الفيديو بالإنجليزية' : 'Enter video description in English'"
                                        class="w-full p-4 rounded-xl border border-[#CBD5E1] bg-white text-[#0F172A] focus:outline-none focus:border-[#1877F2] focus:ring-4 focus:ring-[#1877F2]/10 transition-all font-medium placeholder:text-[#94A3B8] resize-none leading-relaxed"
                                        dir="ltr">
                                    </textarea>
                                </div>
                            </div>

                            <div class="flex flex-col gap-2">
                                <label class="block text-sm font-bold text-[#0F172A]">
                                    {{ 'THUMBNAIL' | translate }}
                                </label>
                                <div (click)="changeThumbnail()"
                                    class="aspect-video w-full rounded-xl border border-[#E2E8F0] overflow-hidden relative group cursor-pointer bg-[#F8FAFC]">
                                    <img [src]="videoThumbnail" alt="Thumbnail" class="w-full h-full object-cover" />
                                    <div
                                        class="absolute inset-0 bg-black/40 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity backdrop-blur-[2px]">
                                        <button
                                            class="bg-white/20 backdrop-blur-md border border-white/50 text-white px-4 py-2 rounded-lg font-bold text-sm flex items-center gap-2 hover:bg-white hover:text-[#0F172A] transition-all">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none"
                                                viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                                            </svg>
                                            {{ 'CHANGE_IMAGE' | translate }}
                                        </button>
                                    </div>
                                </div>
                                <p class="text-xs text-[#64748B] font-medium leading-relaxed">
                                    {{ 'THUMBNAIL_RECOMMENDATION' | translate }}
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Attachments Section -->
                    <div class="bg-white rounded-2xl border border-[#E2E8F0] shadow-sm overflow-hidden">
                        <div
                            class="px-4 sm:px-6 py-4 sm:py-5 border-b border-[#F1F5F9] flex items-center justify-between">
                            <div class="flex items-center gap-3">
                                <div class="w-1 h-5 bg-[#1877F2] rounded-full"></div>
                                <h2 class="font-bold text-base sm:text-lg text-[#0F172A]">{{ 'ATTACHMENTS' | translate
                                    }}</h2>
                            </div>
                        </div>

                        <div class="p-4 sm:p-6 grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-6">
                            <div *ngFor="let attachment of attachments"
                                [class]="attachment.type === 'pdf'
                                    ? 'flex items-center p-4 rounded-xl border border-[#FEE2E2] bg-[#FEF2F2] hover:shadow-md transition-shadow group'
                                    : 'flex items-center p-4 rounded-xl border border-[#FFEDD5] bg-[#FFF7ED] hover:shadow-md transition-shadow group'">
                                <div
                                    [class]="attachment.type === 'pdf'
                                    ? 'w-10 h-10 sm:w-12 sm:h-12 rounded-lg bg-white flex items-center justify-center text-[#EF4444] shadow-sm shrink-0'
                                    : 'w-10 h-10 sm:w-12 sm:h-12 rounded-lg bg-white flex items-center justify-center text-[#F97316] shadow-sm shrink-0'">
                                    <svg *ngIf="attachment.type === 'pdf'" xmlns="http://www.w3.org/2000/svg"
                                        class="w-5 h-5 sm:w-6 sm:h-6" fill="currentColor" viewBox="0 0 24 24">
                                        <path
                                            d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8l-6-6zM6 20V4h7v5h5v11H6z" />
                                    </svg>
                                    <svg *ngIf="attachment.type === 'ppt'" xmlns="http://www.w3.org/2000/svg"
                                        class="w-5 h-5 sm:w-6 sm:h-6" fill="currentColor" viewBox="0 0 24 24">
                                        <path
                                            d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8l-6-6zM9 16H7v-6h4a2 2 0 110 4H9v2zm0-4h2a1 1 0 100-2H9v2z" />
                                    </svg>
                                </div>
                                <div class="mr-3 sm:mr-4 flex-1 min-w-0">
                                    <div class="flex items-center justify-between mb-1">
                                        <h3 class="font-bold text-[#0F172A] text-xs sm:text-sm">{{
                                            getAttachmentName(attachment) }}</h3>
                                        <span *ngIf="attachment.isRequired"
                                            class="text-[10px] font-bold text-[#EF4444] bg-white px-1.5 py-0.5 rounded border border-[#FECACA]">
                                            {{ 'REQUIRED' | translate }}
                                        </span>
                                        <span *ngIf="!attachment.isRequired"
                                            class="text-[10px] font-bold text-[#94A3B8] bg-white px-1.5 py-0.5 rounded border border-[#E2E8F0]">
                                            {{ 'OPTIONAL' | translate }}
                                        </span>
                                    </div>
                                    <p *ngIf="attachment.isUploaded" class="text-xs text-[#7F1D1D] truncate">{{
                                        attachment.fileName }}</p>
                                    <p *ngIf="!attachment.isUploaded" class="text-xs text-[#9A3412] italic opacity-80">
                                        {{ 'NOT_UPLOADED_YET' | translate }}</p>
                                    <p *ngIf="attachment.size" class="text-[10px] text-[#991B1B] mt-1">{{
                                        attachment.size }}</p>
                                </div>
                                <button (click)="uploadAttachment(attachment)"
                                    [class]="attachment.isUploaded
                                        ? 'mr-2 px-3 py-2 rounded-lg text-[#64748B] hover:bg-white hover:shadow-sm transition-all text-xs font-bold whitespace-nowrap'
                                        : 'mr-2 px-3 py-2 rounded-lg bg-white border border-[#E2E8F0] text-[#64748B] hover:bg-[#3B82F6] hover:text-white hover:border-[#3B82F6] transition-all text-xs font-bold whitespace-nowrap flex items-center gap-1 shadow-sm'">
                                    <svg *ngIf="!attachment.isUploaded" xmlns="http://www.w3.org/2000/svg"
                                        class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                                    </svg>
                                    {{ attachment.isUploaded ? ('UPDATE' | translate) : ('UPLOAD_FILE' | translate) }}
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Column (Sidebar) -->
                <div class="xl:col-span-4 flex flex-col gap-6">

                    <!-- Workflow Section -->
                    <div
                        class="bg-white rounded-2xl border border-[#E2E8F0] shadow-sm overflow-hidden xl:sticky xl:top-24">
                        <div
                            class="px-4 sm:px-6 py-4 sm:py-5 border-b border-[#F1F5F9] flex items-center justify-between">
                            <h2 class="font-bold text-base sm:text-lg text-[#0F172A]">{{ 'WORKFLOW' | translate }}</h2>
                        </div>

                        <div class="p-4 sm:p-6">
                            <div class="relative flex flex-col gap-6 sm:gap-8">
                                <div class="absolute top-2 bottom-2 right-[19px] w-0.5 bg-[#E2E8F0]"></div>

                                <!-- Uploaded By -->
                                <div class="relative flex gap-4">
                                    <div
                                        class="z-10 w-10 h-10 rounded-full bg-[#EFF6FF] border-4 border-white shadow-sm flex items-center justify-center text-[#1877F2] shrink-0">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none"
                                            viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                                        </svg>
                                    </div>
                                    <div class="flex-1 pt-1">
                                        <p class="text-xs font-bold text-[#64748B] mb-1">{{ 'UPLOADED_BY' | translate }}
                                        </p>
                                        <div class="flex items-center gap-2">
                                            <img src="https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=100&h=100&fit=crop"
                                                class="w-6 h-6 rounded-full" alt="uploader" />
                                            <span class="text-sm font-bold text-[#0F172A]">{{ displayUploadedBy
                                                }}</span>
                                        </div>
                                        <p *ngIf="displayUploadDate"
                                            class="text-[10px] text-[#94A3B8] mt-1 font-semibold">{{ displayUploadDate
                                            }}</p>
                                    </div>
                                </div>

                                <!-- Reviewed By -->
                                <div class="relative flex gap-4">
                                    <div
                                        class="z-10 w-10 h-10 rounded-full bg-[#FEF9C3] border-4 border-white shadow-sm flex items-center justify-center text-[#CA8A04] shrink-0">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none"
                                            viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                                        </svg>
                                    </div>
                                    <div class="flex-1 pt-1">
                                        <p class="text-xs font-bold text-[#64748B] mb-1">{{ 'REVIEWED_BY' | translate }}
                                        </p>
                                        <div class="relative">
                                            <select [(ngModel)]="selectedReviewer"
                                                class="w-full h-10 pl-3 pr-9 bg-[#F8FAFC] border border-[#E2E8F0] rounded-lg text-sm font-bold text-[#0F172A] appearance-none focus:outline-none focus:border-[#CA8A04] transition-colors cursor-pointer">
                                                <option *ngFor="let reviewer of reviewers" [value]="reviewer">{{
                                                    reviewer }}</option>
                                            </select>
                                            <svg xmlns="http://www.w3.org/2000/svg"
                                                class="absolute left-3 top-3 text-[#64748B] w-4 h-4 pointer-events-none"
                                                fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M19 9l-7 7-7-7" />
                                            </svg>
                                        </div>
                                    </div>
                                </div>

                                <!-- Video Status -->
                                <div class="relative flex gap-4">
                                    <div
                                        class="z-10 w-10 h-10 rounded-full bg-[#ECFDF5] border-4 border-white shadow-sm flex items-center justify-center text-[#10B981] shrink-0">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none"
                                            viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M5 13l4 4L19 7" />
                                        </svg>
                                    </div>
                                    <div class="flex-1 pt-1">
                                        <p class="text-xs font-bold text-[#64748B] mb-2">{{ 'VIDEO_STATUS' | translate
                                            }}</p>
                                        <div class="flex flex-col gap-2">
                                            <label (click)="setVideoStatus('published')"
                                                [class]="videoStatus === 'published'
                                                    ? 'flex items-center gap-3 p-3 rounded-xl border-2 transition-all cursor-pointer border-[#10B981] bg-[#ECFDF5]/30'
                                                    : 'flex items-center gap-3 p-3 rounded-xl border-2 transition-all cursor-pointer border-[#E2E8F0] bg-white hover:border-[#CBD5E1]'">
                                                <div
                                                    [class]="videoStatus === 'published'
                                                    ? 'w-5 h-5 rounded-full border flex items-center justify-center border-[#10B981] bg-[#10B981]'
                                                    : 'w-5 h-5 rounded-full border flex items-center justify-center border-[#CBD5E1] bg-white'">
                                                    <svg *ngIf="videoStatus === 'published'"
                                                        xmlns="http://www.w3.org/2000/svg"
                                                        class="w-2.5 h-2.5 text-white" fill="none" viewBox="0 0 24 24"
                                                        stroke="currentColor">
                                                        <path stroke-linecap="round" stroke-linejoin="round"
                                                            stroke-width="3" d="M5 13l4 4L19 7" />
                                                    </svg>
                                                </div>
                                                <span
                                                    [class]="videoStatus === 'published' ? 'text-sm font-bold text-[#065F46]' : 'text-sm font-bold text-[#64748B]'">
                                                    {{ 'PUBLISHED' | translate }} (Published)
                                                </span>
                                            </label>

                                            <label (click)="setVideoStatus('draft')"
                                                [class]="videoStatus === 'draft'
                                                    ? 'flex items-center gap-3 p-3 rounded-xl border-2 transition-all cursor-pointer border-[#64748B] bg-[#F1F5F9]'
                                                    : 'flex items-center gap-3 p-3 rounded-xl border-2 transition-all cursor-pointer border-[#E2E8F0] bg-white hover:border-[#CBD5E1]'">
                                                <div
                                                    [class]="videoStatus === 'draft'
                                                    ? 'w-5 h-5 rounded-full border flex items-center justify-center border-[#64748B] bg-[#64748B]'
                                                    : 'w-5 h-5 rounded-full border flex items-center justify-center border-[#CBD5E1] bg-white'">
                                                    <svg *ngIf="videoStatus === 'draft'"
                                                        xmlns="http://www.w3.org/2000/svg"
                                                        class="w-2.5 h-2.5 text-white" fill="none" viewBox="0 0 24 24"
                                                        stroke="currentColor">
                                                        <path stroke-linecap="round" stroke-linejoin="round"
                                                            stroke-width="3" d="M5 13l4 4L19 7" />
                                                    </svg>
                                                </div>
                                                <span
                                                    [class]="videoStatus === 'draft' ? 'text-sm font-bold text-[#1E293B]' : 'text-sm font-bold text-[#64748B]'">
                                                    {{ 'DRAFT' | translate }} (Draft)
                                                </span>
                                            </label>
                                        </div>
                                        <p class="text-[10px] text-[#94A3B8] mt-3 leading-relaxed">
                                            {{ 'VIDEO_VISIBILITY_NOTE' | translate }}
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Comments Section (only show in edit mode) -->
                    <div *ngIf="!isAddMode"
                        class="bg-white rounded-2xl border border-[#E2E8F0] shadow-sm overflow-hidden">
                        <div
                            class="px-4 sm:px-6 py-4 sm:py-5 border-b border-[#F1F5F9] flex items-center justify-between">
                            <div class="flex items-center gap-2">
                                <h2 class="font-bold text-base sm:text-lg text-[#0F172A]">{{ 'STUDENT_COMMENTS' |
                                    translate }}</h2>
                                <span
                                    class="bg-[#EFF6FF] text-[#1877F2] text-[10px] font-black px-1.5 py-0.5 rounded border border-[#DBEAFE]">
                                    {{ comments.length }} {{ 'NEW' | translate }}
                                </span>
                            </div>
                        </div>

                        <div class="flex flex-col max-h-[500px] overflow-y-auto">
                            <div class="p-4 sm:p-6 flex flex-col gap-6">
                                <div *ngFor="let comment of comments" class="flex gap-3">
                                    <img [src]="comment.avatar"
                                        class="w-9 h-9 sm:w-10 sm:h-10 rounded-full object-cover ring-2 ring-white shadow-sm shrink-0"
                                        alt="student" />
                                    <div class="flex-1">
                                        <div
                                            [class]="comment.isAdmin ? 'bg-[#EFF6FF] p-3 sm:p-3.5 rounded-2xl rounded-tr-none border border-[#DBEAFE]' : 'bg-[#F8FAFC] p-3 sm:p-3.5 rounded-2xl rounded-tr-none border border-[#F1F5F9]'">
                                            <div class="flex items-center justify-between mb-1">
                                                <h4
                                                    [class]="comment.isAdmin ? 'text-xs font-bold text-[#1877F2]' : 'text-xs font-bold text-[#0F172A]'">
                                                    {{ getCommentAuthor(comment) }}</h4>
                                                <span class="text-[10px] text-[#94A3B8]">{{ getCommentDate(comment)
                                                    }}</span>
                                            </div>
                                            <p class="text-xs text-[#475569] leading-relaxed">
                                                {{ getCommentContent(comment) }}
                                            </p>
                                        </div>
                                        <div class="flex gap-4 mt-1.5 pr-2">
                                            <button (click)="startReply(comment.id)"
                                                class="text-[10px] font-bold text-[#64748B] hover:text-[#1877F2]">{{
                                                'REPLY' | translate }}</button>
                                            <button (click)="hideComment(comment)"
                                                class="text-[10px] font-bold text-[#64748B] hover:text-[#EF4444]">{{
                                                'HIDE' | translate }}</button>
                                        </div>

                                        <!-- Reply Input -->
                                        <div *ngIf="replyingToId === comment.id"
                                            class="mt-3 mr-2 flex gap-2 border-r-2 border-[#DBEAFE] pr-4">
                                            <input type="text" [(ngModel)]="replyText"
                                                [placeholder]="translationService.current === 'ar' ? 'اكتب ردك هنا...' : 'Write your reply...'"
                                                class="flex-1 h-9 px-3 rounded-lg border border-[#CBD5E1] text-sm focus:outline-none focus:border-[#1877F2]" />
                                            <button (click)="submitReply(comment)"
                                                class="px-3 py-1.5 bg-[#1877F2] text-white rounded-lg text-xs font-bold hover:bg-[#1565D8]">
                                                {{ translationService.current === 'ar' ? 'إرسال' : 'Send' }}
                                            </button>
                                            <button (click)="cancelReply()"
                                                class="px-3 py-1.5 bg-[#F1F5F9] text-[#64748B] rounded-lg text-xs font-bold hover:bg-[#E2E8F0]">
                                                {{ 'CANCEL' | translate }}
                                            </button>
                                        </div>

                                        <!-- Replies -->
                                        <div *ngFor="let reply of comment.replies"
                                            class="mt-3 mr-2 flex gap-3 border-r-2 border-[#E2E8F0] pr-4">
                                            <img [src]="reply.avatar"
                                                class="w-7 h-7 sm:w-8 sm:h-8 rounded-full ring-2 ring-[#F1F5F9] shrink-0"
                                                alt="admin" />
                                            <div
                                                [class]="reply.isAdmin ? 'bg-[#EFF6FF] p-3 rounded-2xl rounded-tr-none border border-[#DBEAFE] flex-1' : 'bg-[#F8FAFC] p-3 rounded-2xl rounded-tr-none border border-[#F1F5F9] flex-1'">
                                                <div class="flex items-center justify-between mb-1">
                                                    <h4
                                                        [class]="reply.isAdmin ? 'text-xs font-bold text-[#1877F2]' : 'text-xs font-bold text-[#0F172A]'">
                                                        {{ getCommentAuthor(reply) }}</h4>
                                                    <span class="text-[10px] text-[#94A3B8]">{{ getCommentDate(reply)
                                                        }}</span>
                                                </div>
                                                <p class="text-xs text-[#334155] leading-relaxed">
                                                    {{ getCommentContent(reply) }}
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Empty state -->
                                <div *ngIf="comments.length === 0" class="text-center py-8">
                                    <p class="text-sm text-[#94A3B8]">{{ translationService.current === 'ar' ? 'لا توجد
                                        تعليقات بعد' : 'No comments yet' }}</p>
                                </div>
                            </div>

                            <!-- Quick Reply Input -->
                            <div class="p-4 bg-[#F8FAFC] border-t border-[#F1F5F9]">
                                <div class="relative">
                                    <input type="text" [(ngModel)]="newComment" (keyup.enter)="sendQuickReply()"
                                        [placeholder]="'WRITE_QUICK_REPLY' | translate"
                                        class="w-full h-10 pl-10 pr-4 rounded-xl border border-[#CBD5E1] bg-white text-sm focus:outline-none focus:border-[#1877F2] focus:ring-2 focus:ring-[#1877F2]/10 transition-all placeholder:text-[#94A3B8]" />
                                    <button (click)="sendQuickReply()"
                                        class="absolute left-1.5 top-1.5 p-1.5 bg-[#1877F2] text-white rounded-lg hover:bg-[#1565D8] transition-colors shadow-sm">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 transform rotate-180"
                                            fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
</div>